
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link href="~/css/layui.css" rel="stylesheet" />
    <script src="~/layui.js"></script>
    <script src="~/js/zagJs.js"></script>

    <style>
        img {
            display: inline-block;
            width: auto;
            min-width: 40px;
            max-width: 100%;
            height: 150px;
        }

        p {
            padding: 10px;
            border-right: 1px solid gray;
            max-height: 140px;
            overflow-y: scroll;
            color: #646464;
        }
        
        .layui-container{
        	max-width: 960px;
        }
        .titles{
        	text-align: center;
        }

        .layui-row div {
            border: 1px solid gray;
            /*height: 40px;*/
            line-height: 40px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .noborder-l {
            border: none !important;
            border-left: 1px solid gray !important;
            border-bottom: 1px solid gray !important;
        }

        .noborder-r {
            border: none !important;
            border-right: 1px solid gray !important;
            border-bottom: 1px solid gray !important;
        }
        .imgboxs{
        	min-height: 150px;
        }
        
        @@media only screen and (max-width: 420px) {
        	.layui-row div{
        		border: none 0 !important;
        	}
        	.imgBox{
        		min-height: 100px;
        	}
        	.imgboxs{
	        	min-height: 100px;
	        }
        	.theImg{
        		/*min-width: 280px;*/
        	}
        	.theImg img{
        		/*width: auto;*/
        		height: auto;
        	}
        	.theCont{
        		word-break: break-all;
        		height: auto !important;
        		background-color: #f0f0f0;
        		margin-bottom: 10px;
        	}
        	.titles{
        		font-weight: bold;
        		text-align: right;
        		padding-right: 10px !important;
        	}
        	.smaFont{
        		font-size: 12px;
        	}
        }
        @@media only screen and (max-width: 360px) {
        	.titles{
        		width: 30%;
        	}
        	.contents{
        		width: 70%;
        	}
        }
        @@media only screen and (max-width: 320px) {
        	body{
        		font-size: 12px;
        	}
        	
        	.smaFont{
        		font-size: 10px;
        	}
        }
        
        /*打印*/
        @@media only screen and (min-width: 421px) and (max-width: 767px) {
        	.titles{
        		width: 30%;
        	}
        	.contents{
        		width: 70%;
        	}
        	.theCont{
        		width: 70%;
        	}
        	.theImg{
        		width: 30%;
        	}
        	.noborder-l{
        		width: 50%;
        		float: left;
        	}
        	.noborder-r{
        		width: 50%;
        		float: right;
        	}
        	hr{
        		display: none;
        	}
        }
    </style>
</head>

<body>
    <div id="view"></div>

    <script id="demo" type="text/html">
        <div class="layui-container" style="">
            <h2 style="text-align: center;">项目（HSE）现场隐患问题整改通知单</h2>
            <br />
            <h3 style="text-align: right;">编号：<span>{{d.y_no}}</span></h3>
            <br />

            <div class="layui-row">
                <div class="layui-col-xs3 layui-col-sm2 layui-col-md2 titles">
                   	 项目名称
                </div>
                <div class="layui-col-xs9 layui-col-sm5 layui-col-md6 contents">
                    {{d.y_name}}
                </div>
                <div class="layui-col-xs3 layui-col-sm2 layui-col-md2 titles">
                    	检查日期
                </div>
                <div class="layui-col-xs9 layui-col-sm3 layui-col-md2 contents">
                    {{d.y_createtime}}
                </div>
            </div>

            <div class="layui-row">
                <div class="layui-col-xs3 layui-col-sm2 layui-col-md2 titles">
                    	检查内容
                </div>
                <div class="layui-col-xs9 layui-col-sm10 layui-col-md10 contents">
                    {{d.y_body}}
                </div>
            </div>

            <div class="layui-row">
                <div class="layui-col-xs3 layui-col-sm2 layui-col-md2 titles">
                    	隐患类别
                </div>
                <div class="layui-col-xs9 layui-col-sm10 layui-col-md10 contents">
                    {{d.y_type}}
                </div>
            </div>

            <div class="layui-row">
                <div class="layui-col-xs3 layui-col-sm2 layui-col-md2 titles">
                   	 严重程度
                </div>
                <div class="layui-col-xs9 layui-col-sm10 layui-col-md10 contents">
                    {{d.y_dengji}}
                </div>
            </div>

            <div class="layui-row imgBox">
                <div class="layui-col-xs12" style="min-height: 120px; border-bottom: none;">
                   	<span class="titles">基本描述：</span> 
                    <br />
                    <div class="layui-col-xs12 layui-col-sm9 theCont" style="border: none;">
                        {{d.y_desc}}
                    </div>
                    <div class="layui-col-xs12 layui-col-sm3 theImg" style="border: none;">
                        <img src="{{d.y_img1}}"  onerror="imgerror(this)" />
                    </div>
                </div>
                <div style="height:20px; clear: both; border-top: none; border-bottom: none;"></div>
            </div>
            
            <div class="layui-row">
                <div class="layui-col-xs12" style="min-height: 30px; border-bottom: none; word-break: break-all;">
                    	<span class="titles">整改措施及要求：</span>
                    <br />
                    {{d.y_yaoqiu}}

                </div>
                <div style="clear: both; border-top: none; border-bottom: none;"></div>
                <div class="layui-col-xs12 layui-col-sm6 noborder-l">
                    <span class="titles">整改期限：</span>{{d.y_endtime}}
                </div>
                <div class="layui-col-xs12 layui-col-sm6 noborder-r">
                    <span class="titles">检查人：</span>{{d.jiancha_name}}
                </div>
            </div>
            
            <hr class="layui-hide-sm" />
            
            <div class="layui-row">
                <div class="layui-col-xs3 layui-col-sm2 titles">
                    签发人
                </div>
                <div class="layui-col-xs9 layui-col-sm4 contents">
                    {{d.head_username}}
                </div>
                <div class="layui-col-xs3 layui-col-sm2 titles smaFont">
                    整改负责人
                </div>
                <div class="layui-col-xs9 layui-col-sm4 contents">
                    {{d.zhenggai_name}}
                </div>
            </div>

            <!--<div class="layui-row">
                <div class="layui-col-xs12" style="min-height: 30px; border-bottom: none;">
                    	<span class="titles">整改措施及要求：</span>
                    <br />
                    {{d.y_yaoqiu}}

                </div>
                <div style="clear: both; border-top: none; border-bottom: none;"></div>
            </div>-->
            
            <div class="layui-row">
                <div class="layui-col-xs12 imgboxs" style="border-bottom: none;">
                    	<span class="titles">整改情况说明：</span>
                    <br />
                    <div class="layui-col-xs12 layui-col-sm9 theCont" style="border: none;">
                        {{d.y_zgdesc}}
                    </div>
                    <div class="layui-col-xs12 layui-col-sm3 theImg" style="border: none;">

                        <img src="{{d.y_zgimg}}"  onerror="imgerror(this)" />

                    </div>

                </div>
                <div style="clear: both; border-top: none; border-bottom: none;"></div>
                
                <div class="layui-col-xs12 layui-col-sm6 noborder-l" style="">
                   	<span class="titles">整改负责人：</span>{{d.zhenggai_name}}
                </div>
                <div class="layui-col-xs12 layui-col-sm6 noborder-r" style="">
                   	 <span class="titles">日期：</span>{{d.y_zgtime}}
                </div>
            </div>
            
            <hr class="layui-hide-sm" />

            <div class="layui-row">
                <div class="layui-col-xs12 imgboxs" style="border-bottom: none;">
                    	<span class="titles">整改跟踪验证评定：</span>
                    <br />
                    <div class="layui-col-xs12 layui-col-sm9 theCont" style="border: none;">
                        {{d.y_qrdesc}}
                    </div>
                    <div class="layui-col-xs12 layui-col-sm3 theImg" style="border: none;">

                        <img src="{{d.y_qrimg}}"  onerror="imgerror(this)" />

                    </div>

                </div>
                <div style="clear: both; border-top: none; border-bottom: none;"></div>

                <div class="layui-col-xs12 layui-col-sm6 noborder-l" style="">
                   	<span class="titles">复检人：</span>{{d.queren_name}}
                </div>
                <div class="layui-col-xs12 layui-col-sm6 noborder-r" style="">
                   	 <span class="titles">日期：</span>{{d.y_qrtime}}
                </div>
            </div>
            <br />

        </div>

    </script>
    <div class="layui-btn-group" style="text-align:right;width:90%;margin:20px auto">
        
        <!--<button id="back" class="layui-btn layui-btn-xs from_user" style="margin-right:14px;display:none">
            <i class="layui-icon">&#x1006;</i> 撤消
        </button>
        <button id="del" class="layui-btn layui-btn-xs from_user" style="margin-right:14px;display:none">
            <i class="layui-icon">&#xe640;</i> 删除
        </button>
        <button id="skin" class="layui-btn layui-btn-xs parent_user" style="margin-right:14px;display:none">
            <i class="layui-icon">&#xe679;</i> 审批
        </button>
        <button id="backsp" class="layui-btn layui-btn-xs" style="margin-right:14px;display:none">
            <i class="layui-icon">&#x1006;</i> 撤消审批
        </button>

        <button id="zhenggai" class="layui-btn layui-btn-xs child_user" style="margin-right:14px;display:none">
            <i class="layui-icon">&#xe63c;</i> 整改上报
        </button>
        <button id="jianding" class="layui-btn layui-btn-xs from_user" style="margin-right:14px;display:none">
            <i class="layui-icon">&#xe6b2;</i> 结果评定
        </button>-->
        <button id="print" class="layui-btn  layui-btn-xs layui-btn-warm">
            <i class="layui-icon">&#xe60a;</i> 打印
        </button>
    </div>
    <div style="clear: both;"></div>
    <blockquote class="layui-elem-quote">
        <span>注：一般：指危害和整改难度较小，发现后能够立即整改排除的隐患。严重：指危害和整改难度较大，无法立即整改排除并可能导致人身伤亡或经济损失的隐患。重大：指危害和整改难度重大，应当全部或者局部停产停业，经过一定时间整改治理方能排除的隐患，或者因外部因素影响致使单位自身难以排除的隐患。</span>
    </blockquote>




    <script>
        var userInfo = parent.userInfo,
            configUrl = parent.configUrl;
        var y_id = "@ViewBag.y_id";
        var yh_to_userdown = 0;
        var data = {};

        getdata();
        //get
        function getdata() {
            layui.use(["layer", "laytpl"], function () {
                var layer = layui.layer
                    , laytpl = layui.laytpl,
                    $ = layui.jquery;
                //数据绑定
                if (y_id != "") {
                    $.ajax({
                        url: configUrl + "/api/yhtable/gdt/Query?y_id=" + y_id,
                        type: "post",
                        contentType: "application/json",
                        async: false,
                        success: function (res) {
                            var arr = res.data[0];
                            console.log(res.data);
                            //alert(res.data[0].y_type);
                            arr.head_username = arr.head_username != null ? arr.head_username : "";
                            arr.jiancha_name = arr.jiancha_name != null ? arr.jiancha_name : "";
                            arr.queren_name = arr.queren_name != null ? arr.queren_name : "";
                            arr.zhenggai_name = arr.zhenggai_name != null ? arr.zhenggai_name : "";
                            arr.y_createtime = arr.y_createtime != 0 ? timestampToTime2(arr.y_createtime) : "";
                            arr.y_endtime = arr.y_endtime != 0 ? timestampToTime(arr.y_endtime) : "";
                            arr.y_zgtime = arr.y_zgtime != 0 ? timestampToTime(arr.y_zgtime) : "";
                            arr.y_qrtime = arr.y_qrtime != 0 ? timestampToTime(arr.y_qrtime) : "";
                            arr.y_img1 = configUrl + "/Files/" + arr.y_img1;
                            arr.y_qrimg = configUrl + "/Files/" + arr.y_qrimg;
                            arr.y_zgimg = configUrl + "/Files/" + arr.y_zgimg;
                            if (arr.y_dengji==1){
                                arr.y_dengji = "一般";
                            }
                            if (arr.y_dengji == 2) {
                                arr.y_dengji = "严重";
                            }
                            if (arr.y_dengji == 3) {
                                arr.y_dengji = "重大";
                            }


                            data = arr;
                            var getTpl = demo.innerHTML
                                , view = document.getElementById('view');
                            laytpl(getTpl).render(data, function (html) {
                                view.innerHTML = html;
                            });
                            //y_type,viewImg,y_img1,sex
                        }
                    });
                }
            });
        }


        layui.use(["layer", "laytpl"], function () {
            var layer = layui.layer
                , laytpl = layui.laytpl,
                $ = layui.jquery;
            

            //功能操作
            $("#del").on("click", function () {
                layer.confirm('您确定要删除该隐患检查单吗?', { icon: 3, title: '提示' }, function (index) {
                    //do something
                    layer.load(1);
                    $.ajax({
                        url: configUrl + "/api/yinhuan/gdt/DelYinHuan?yh_no=" + yh_no,
                        type: "post",
                        contentType: "application/json",
                        success: function (res) {
                            layer.closeAll("loading");
                            if (res.code === 0) {
                                layer.msg(res.msg, { icon: 1 });
                            } else {
                                layer.msg(res.msg, { icon: 2 });
                            }
                        }
                    });
                    layer.close(index);
                });
            });

            //撤消
            $("#back").on("back", function () {
                layer.confirm('撤消隐患整改单，将会使其他人不可见，点击“确定”按钮继续！', { icon: 3, title: '提示' }, function (index) {
                    //do something
                    layer.load(1);
                    $.ajax({
                        url: configUrl + "/api/yinhuan/gdt/BackYinHuan?yh_no=" + yh_no,
                        type: "post",
                        contentType: "application/json",
                        success: function (res) {
                            layer.closeAll("loading");
                            if (res.code === 0) {
                                layer.msg(res.msg, { icon: 1 });
                            } else {
                                layer.msg(res.msg, { icon: 2 });
                            }
                        }
                    });
                    layer.close(index);
                });
            });

            ///审批通过，并下发通知给整改负责人
            $("#skin").on("click", function () {
                layer.confirm('点击“确定”说明您已认定该表单内容的整改合理性，同时，将信息提交至整改部门', { icon: 3, title: '提示' }, function (index) {
                    //do something
                    layer.load(1);
                    $.ajax({
                        url: configUrl + "/api/yinhuan/gdt/UpdateYinHuan_up?yh_no=" + yh_no + "&yh_to_userdown=" + yh_to_userdown,
                        type: "post",
                        contentType: "application/json",
                        success: function (res) {
                            layer.closeAll("loading");
                            if (res.code === 0) {
                                layer.msg(res.msg, { icon: 1 });
                            } else {
                                layer.msg(res.msg, { icon: 2 });
                            }
                        }
                    });
                    layer.close(index);
                });
            });

            $("#zhenggai").on("click", function () {
                //整改部门填定的整改后的说明，以及整改后的图片信息
            });

            $("#jianding").on("click", function () {
                //一般由检查人员进行填写，内容为对整改后结果进行评价
                layer.open({
                    type: 2,
                    title: "复查评定",
                    content: "/YinHuan/YinHuanJianDing?yh_no=" + yh_no,
                    area:["90%","90%"]
                });
            });

            $("#print").on("click", function () {
                //实现打印表单
                printpage();
            });

            function printpage() {
                //var newstr = document.all.item(myDiv).innerHTML;
                var newstr = document.getElementById("view").innerHTML;
                var oldstr = document.body.innerHTML;
                document.body.innerHTML = newstr;
                window.print();
                document.body.innerHTML = oldstr;
                return false;
            }
        });
        
        function imgerror(img){
			img.src="../error.jpg";
			img.onerror=null;   //控制不要一直跳动
		}
    </script>
</body>
</html>
