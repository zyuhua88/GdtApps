
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>AddTestClassify</title>
    <link href="~/css/layui.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/layui.js"></script>
    <style>
        html,body{width:100%;height:100%;padding:0px;margin:0px;background:#f0f0f0}
    </style>
</head>
<body>
    <div class="layui-fluid" style="width:96%;height:90%;background:#fff;margin:18px auto;overflow-y:auto">
        <form class="layui-form" lay-filter="form" style="padding:30px 0px">
            <div class="layui-row layui-col-space10">
                <div class="layui-col-xs10 layui-col-sm4 layui-col-md4">
                    <div class="layui-form-item">
                        <label class="layui-form-label">试题名称</label>
                        <div class="layui-input-block">
                            <input type="text" name="t_name" required lay-verify="required" placeholder="请输入试题名称" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row layui-col-space10">
                <blockquote class="layui-elem-quote">
                    试题配置项<span style="font-size:12px;color:#ff6a00">
                        注：本配置项适用于模拟考试时的出题数量
                    </span>
                </blockquote>
                <div class="layui-col-xs8 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <label class="layui-form-label">是非题量</label>
                        <div class="layui-input-block">
                            <input type="number" name="type_a" required lay-verify="number" value="30" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs10 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <label class="layui-form-label">每题得分</label>
                        <div class="layui-input-block">
                            <select name="defen_a" lay-verify="required">
                                <option value="1" selected>每题1分</option>
                                <option value="2">每题2分</option>
                                <option value="3">每题3分</option>
                                <option value="4">每题4分</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="layui-row layui-col-space10">
                <div class="layui-col-xs8 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <label class="layui-form-label">单选题量</label>
                        <div class="layui-input-block">
                            <input type="number" name="type_b" required lay-verify="number" value="30" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs10 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <label class="layui-form-label">每题得分</label>
                        <div class="layui-input-block">
                            <select name="defen_b" lay-verify="required">
                                <option value="1" selected>每题1分</option>
                                <option value="2">每题2分</option>
                                <option value="3">每题3分</option>
                                <option value="4">每题4分</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="layui-row layui-col-space10">
                <div class="layui-col-xs8 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <label class="layui-form-label">多选题量</label>
                        <div class="layui-input-block">
                            <input type="number" name="type_c" required lay-verify="number" value="20" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs10 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <label class="layui-form-label">每题得分</label>
                        <div class="layui-input-block">
                            <select name="defen_c" lay-verify="required">
                                <option value="1">每题1分</option>
                                <option value="2" selected>每题2分</option>
                                <option value="3">每题3分</option>
                                <option value="4">每题4分</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row layui-col-space10">
                <div class="layui-col-xs8 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <label class="layui-form-label">案例题量</label>
                        <div class="layui-input-block">
                            <input type="number" name="type_d" required lay-verify="number" value="20" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs10 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <label class="layui-form-label">每题得分</label>
                        <div class="layui-input-block">
                            <select name="defen_d" lay-verify="required">
                                <option value="1">每题1分</option>
                                <option value="2" selected>每题2分</option>
                                <option value="3">每题3分</option>
                                <option value="4">每题4分</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row layui-col-space10">
                <div class="layui-col-xs12 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <label class="layui-form-label">试题分类</label>
                        <div class="layui-input-block">
                            <select name="t_types" lay-verify="required">
                                <option value="0">普通题库</option>
                                <option value="1" selected>厂级教育</option>
                                <option value="2">车间级教育</option>
                                <option value="3">班组级教育</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>


            <div class="layui-row layui-col-space10">
                <div class="layui-col-xs6 layui-col-sm3 layui-col-md3">
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="formDemo">提交信息到题库</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        
    </div>

    <script>
        var userInfo = parent.userInfo,
            configUrl = parent.configUrl;
        var id = "@ViewBag.id";

        layui.use(["form", "layer", "element"], function () {
            var $ = layui.jquery
                , form = layui.form
                , layer = layui.layer,
                element = layui.element;

            if (id != "" && id != null) {
                $.ajax({
                    url: configUrl + "/api/test_classify/gdt/query?id=" + id,
                    type: "post",
                    contentType: "application/json",
                    async: false,
                    success: function (res) {
                        var data = res.data[0];
                        //alert(res);
                        form.val("form", {
                            "t_name": data.t_name,
                            "type_a": data.type_a,
                            "type_b": data.type_b,
                            "type_c": data.type_c,
                            "type_d": data.type_d,
                            "defen_a": "" + data.defen_a,
                            "defen_b": "" + data.defen_b,
                            "defen_c": "" + data.defen_c,
                            "defen_d": "" + data.defen_d,
                            "t_types": "" + data.t_types
                        });
                        form.render();
                    }
                });
                
            }

            //上传数据
            form.on("submit(formDemo)", function (obj) {
                obj.field.head_id = userInfo.data[0].head_id;
                obj.field.us_id = userInfo.data[0].us_id;
                var data = obj.field;
                layer.load();
                var urls = configUrl + "/api/test_classify/gdt/add";
                if (id != "" && id != null) {
                    urls = configUrl + "/api/test_classify/gdt/update?id=" + id;
                }

                $.ajax({
                    url: urls,
                    type: "post",
                    contentType: "application/json",
                    data: JSON.stringify(data),
                    success: function (res) {
                        layer.closeAll("loading");
                        if (res.code == 0) {
                            parent.getTest();
                            layer.msg(res.msg, { icon: 1,time:2000,shade:0.5 }, function () {
                                //当你在iframe页面关闭自身时
                                var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                                parent.layer.close(index); //再执行关闭
                            });
                        } else {
                            layer.msg(res.msg, { icon: 2,shade:0.5 });
                        }
                    }
                });
                return false;
            });
        });
    </script>
</body>
</html>
